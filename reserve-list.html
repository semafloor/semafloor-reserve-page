<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="reserve-list-theme.html">

<link rel="import" href="../iron-list/iron-list.html">
<link rel="import" href="../iron-ajax/iron-ajax.html">

<link rel="import" href="../paper-ripple/paper-ripple.html">

<dom-module id="reserve-list">
  <template>
    <style include="reserve-list-theme"></style>

    <iron-ajax id="listAjax"
      auto
      url="../json/[[name]]-booking.json"
      handle-as="json"
      last-response="{{_reservations}}"></iron-ajax>

    <!-- <div class="list-container"> -->
      <iron-list id="reserveList" items="[[_reservations]]">
        <template>
          <div class="reserve-item" aria-expanded$="[[_isExpanded(index)]]" aria-controls$="[[_isCollapsible(index)]]" on-tap="_toggle">
            <!-- <span>[[index]]</span> -->
            <div class="item-container">
              <div class="item-left">
                <div class="item-room">[[item.room]]</div>
                <div class="item-site">[[item.site]]</div>
              </div>

              <div class="item-right">
                <div class="item-period">[[item.period]]</div>
                <div class="item-subject">[[item.subject]]</div>
              </div>
            </div>

            <!-- <paper-ripple></paper-ripple> -->
            <div id$="[[_isCollapsible(index)]]" class="collapsible-item">
              Lorem ipsum dolor sit amet, consectetur adipisicing elit. Sequi animi cum, ut, nostrum tenetur harum!
            </div>
          </div>
        </template>
      </iron-list>
    <!-- </div> -->
  </template>
  <script>
    Polymer({
      is: 'reserve-list',

      properties: {
        name: String,

        _reservations: {
          type: Object,
          value: function () {
            return [];
          }
        },

      },

      // observers: [
      //   '_logResponse(_reservations)',
      //   '_logName(name)'
      // ],

      // _logResponse: function (_response) {
      //   console.log(_response);
      // },
      //
      // _logName: function (_name) {
      //   console.log(_name);
      // },

      updateList: function () {
        this.$.reserveList.fire('iron-resize');
      },

      _isExpanded: function (_idx) {
        return 'opened' + _idx;
      },

      _isCollapsible: function (_idx) {
        return 'collapse' + _idx;
      },

      _toggle: function (ev) {
        // console.log(ev);
        var _target = ev.target;
        if (_target && _target.hasAttribute('aria-controls')) {
          _target = this.$$('#' + _target.getAttribute('aria-controls'));
          var _isOpened = _target.classList.contains('opened');
          if (_target) {
            if (_isOpened) {
              _target.classList.remove('opened');
            }else {
              _target.classList.add('opened');
            }
            this.$.reserveList.updateSizeForItem(ev.model.index);
          }
        }
      },


    });
  </script>
</dom-module>
